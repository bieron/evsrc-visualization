"use strict";function parseRow(a){return{fileA:a.FileA,fileB:a.FileB,corr:parseFloat(a.pcorValues)}}function computeNetwork(a,b){var c=[],d=[],e=_.map(a,parseRow),f=_.pluck(e,"fileA"),g=_.pluck(e,"fileB"),h=_.union(f,g),i={},j=[],k=["#f08080","#a0f0a0","#a0a0f0","#a0f0f0","#f0a0f0","#f0f0a0","#60f020","#a040a0","#f0a080","#80f0a0","#20f0f0","#f0f020","#b0b040","#40b0f0"];return _.each(h,function(a,b){d.push({name:a,index:b}),i[a]=b}),_.each(e,function(a){var e,f,g,h,k=i[a.fileA],l=i[a.fileB];if(a.corr>b)if(c.push({source:k,target:l}),e=d[k],f=d[l],g=e.cluster,h=f.cluster,"undefined"==typeof g&&"undefined"==typeof h)e.cluster=[e,f],f.cluster=e.cluster,j.push(e.cluster);else if("undefined"==typeof g)h.push(e),e.cluster=h;else if("undefined"==typeof h)g.push(f),f.cluster=g;else if(g!==h){var m=g.concat(h);_.each(m,function(a){a.cluster=m}),j[j.indexOf(g)]=m,j[j.indexOf(h)]=void 0}}),_.each(j,function(a,b){if("undefined"!=typeof a){var c={tooltip:[],name:"cluster"+b};_.each(a,function(a,b){a.color=k[b],a.group=c,c.tooltip.push('<span style="color:'+a.color+'">'+a.name+"</span>"),delete a.cluster}),c.tooltip=c.tooltip.join("<br>")}}),{nodes:d,links:c}}var tip=d3.tip().attr("class","d3-tip").offset([-20,0]).html(function(a){return a});d3.tsv("data/partialCorrelations_0.1.sif",function(a,b){if(a)throw a;var c=computeNetwork(b,0),d=d3.select("#visualization-container"),e=d.selectAll("svg").data([c]),f=Math.min(parseInt(d.style("width"),10),750),g=f,h=d3.layout.force().nodes(c.nodes).links(c.links).gravity(.15).size([f,g]).start();e.enter().append("svg").classed("network-chart",!0).call(tip),e.attr("width",f).attr("height",g);var i=e.selectAll(".link").data(c.links);i.enter().append("line").classed("link",!0);var j=e.selectAll(".node").data(c.nodes);j.enter().append("circle").classed("node",!0).attr("r",5).call(h.drag),e.selectAll(".node").each(function(a){d3.select(this).classed(a.group.name,!0)}),j.on("mouseover",function(a){e.selectAll("."+a.group.name).each(function(a){d3.select(this).transition().style("fill",a.color)}),tip.show(a.group.tooltip)}).on("mouseout",function(a){e.selectAll("."+a.group.name).transition().style("fill","#bcbcbc"),tip.hide(a)}),h.on("tick",function(){i.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),j.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}),j.exit().remove(),i.exit().remove(),e.exit().remove()});